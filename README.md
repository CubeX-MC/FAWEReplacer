# FAWEReplace

> **[ä¸­æ–‡](#ä¸­æ–‡æ–‡æ¡£) | [English](README_EN.md)**

---

## ä¸­æ–‡æ–‡æ¡£

### ç®€ä»‹

**FAWEReplace** æ˜¯ä¸€ä¸ªé¢å‘å¤§å‹ Minecraft ä¸–ç•Œæ¸…ç†ä»»åŠ¡çš„é«˜æ€§èƒ½ Paper æ’ä»¶ï¼ŒåŸºäº FastAsyncWorldEdit (FAWE) çš„å¼‚æ­¥èƒ½åŠ›å®ç°é«˜æ•ˆçš„æ‰¹é‡æ–¹å—æ›¿æ¢ä¸å®ä½“ç§»é™¤ã€‚

**ç‰ˆæœ¬**: 1.0.3  
**æ”¯æŒ**: Minecraft 1.20.2+, Paper/Spigot  
**ä¾èµ–**: FastAsyncWorldEdit (FAWE)

### âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸŒ **æ‰¹é‡æ–¹å—æ›¿æ¢** - æ”¯æŒæ•°ç™¾ç§æ–¹å—ç±»å‹çš„æ‰¹é‡æ›¿æ¢æ“ä½œ
- ğŸš€ **é«˜æ€§èƒ½å¼‚æ­¥å¤„ç†** - åŸºäº FAWE å¼‚æ­¥èƒ½åŠ›ï¼Œæ”¯æŒå¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†
- ğŸ“¦ **æ‡’åŠ è½½åˆ‡ç‰‡è°ƒåº¦** - æ— éœ€ä¸€æ¬¡æ€§ç”Ÿæˆæ•°ç™¾ä¸‡ä¸ªä»»åŠ¡ï¼Œå¯ç›´æ¥å¤„ç† 16wÃ—16w ç­‰è¶…å¤§åŒºåŸŸ
- ğŸ’¾ **æ–­ç‚¹ç»­è·‘** - æœåŠ¡å™¨ä¸­æ–­åå¯æ ¹æ®è¿›åº¦è®°å½•è‡ªåŠ¨æ¢å¤ï¼Œç»§ç»­å¤„ç†æœªå®Œæˆçš„åˆ‡ç‰‡
- ğŸ­ **å®ä½“æ¸…ç†** - å¯é€‰çš„å®ä½“ç±»å‹æ¸…ç†åŠŸèƒ½ï¼ˆæ‰è½ç‰©ã€æ€ªç‰©ã€ç›”ç”²æ¶ç­‰ï¼‰
- ğŸŒ **å¤šè¯­è¨€æ”¯æŒ** - å®Œæ•´çš„ä¸­æ–‡/è‹±æ–‡åŒè¯­æ”¯æŒ
- ğŸ›¡ï¸ **å†…å­˜ä¿æŠ¤** - è‡ªåŠ¨ç›‘æ§å†…å­˜ä½¿ç”¨ï¼Œé˜²æ­¢ OutOfMemoryError
- ğŸ”§ **æ™ºèƒ½åŒºå—ä¿®å¤** - è‡ªåŠ¨ä¿®å¤é«˜åº¦å›¾ï¼Œé˜²æ­¢ MCA Selector ä¸­å‡ºç°é»‘è‰²åŒºå—
- ğŸ“Š **å®æ—¶è¿›åº¦ç›‘æ§** - å®æ—¶è¿›åº¦ä¸è¯¦ç»†æ—¥å¿—è¾“å‡ºï¼ŒåŒ…å«æ›¿æ¢æ•°é‡å’Œå®ä½“ç»Ÿè®¡
- âš™ï¸ **çµæ´»é…ç½®** - æ”¯æŒåœ¨çº¿æœåŠ¡å™¨å’Œç¦»çº¿å¤„ç†ä¸¤ç§æ¨¡å¼ï¼Œå¯æ ¹æ®éœ€æ±‚è°ƒæ•´æ€§èƒ½å‚æ•°ace

FAWEReplace æ˜¯ä¸€ä¸ªé¢å‘å¤§å‹ä¸–ç•Œæ¸…ç†ä»»åŠ¡çš„ Paper æ’ä»¶ï¼Œä¾æ‰˜ FastAsyncWorldEdit (FAWE) çš„å¼‚æ­¥èƒ½åŠ›å®ç°é«˜æ•ˆçš„æ‰¹é‡æ›¿æ¢ä¸å®ä½“ç§»é™¤ã€‚æœ¬é¡¹ç›®ç›®å‰å†…ç½®ä¸€å¥—é¢å‘â€œåƒåœ¾æ–¹å—å›æ”¶/æœåŠ¡å™¨æ¸…ç†â€çš„å·¥ä½œæµï¼š

- å¤šç§æ–¹å—çš„æ‰¹é‡æ›¿æ¢ï¼ˆé€šè¿‡é…ç½®åˆ†ç»„ï¼Œç»Ÿä¸€æ›¿æ¢ä¸ºç›®æ ‡æ–¹å—ï¼‰
- æŒ‰æŒ‡å®šåŒºåŸŸæ‹†åˆ†ä¸ºåˆ‡ç‰‡å¹¶å¼‚æ­¥å¤„ç†ï¼Œæ”¯æŒè‡ªå®šä¹‰å¹¶è¡Œåº¦
- **æ‡’åŠ è½½åˆ‡ç‰‡è°ƒåº¦**ï¼šæ— éœ€ä¸€æ¬¡æ€§ç”Ÿæˆæ•°ç™¾ä¸‡ä¸ªä»»åŠ¡ï¼Œå¯ç›´æ¥è¦†ç›– 16wÃ—16w ç­‰è¶…å¤§åŒºåŸŸ
- **æ–­ç‚¹ç»­è·‘**ï¼šæœåŠ¡å™¨ä¸­æ–­åå¯æ ¹æ®è¿›åº¦è®°å½•è‡ªåŠ¨æ¢å¤ï¼Œç»§ç»­æ¸…ç†å°šæœªå®Œæˆçš„åˆ‡ç‰‡
- å¯é€‰å®ä½“æ¸…ç†ï¼ˆæ”¯æŒè‡ªå®šä¹‰å®ä½“ç±»å‹åå•ï¼‰
- å®æ—¶è¿›åº¦ä¸æ—¥å¿—è¾“å‡ºï¼ŒåŒ…å«æ›¿æ¢æ•°é‡å’Œå®ä½“ç»Ÿè®¡

### ğŸš€ å¿«é€Ÿå¼€å§‹

#### 1. å®‰è£…æ’ä»¶

**æ–¹å¼ä¸€ï¼šä» Releases ä¸‹è½½**
```bash
# ä¸‹è½½é¢„ç¼–è¯‘çš„ JAR æ–‡ä»¶
# å°† FAWEReplace-1.0.3-all.jar æ”¾å…¥æœåŠ¡å™¨ plugins/ ç›®å½•
```

**æ–¹å¼äºŒï¼šä»æºç æ„å»º**
```bash
./gradlew clean build
# ç”Ÿæˆçš„ build/libs/FAWEReplace-1.0.3-all.jar æ”¾å…¥æœåŠ¡å™¨ plugins/ ç›®å½•
```

#### 2. é…ç½®æ’ä»¶

å¯åŠ¨æœåŠ¡å™¨åï¼Œç¼–è¾‘ `plugins/FAWEReplace/config.yml`ï¼š

```yaml
# é€‰æ‹©è¯­è¨€
language: zh_CN  # æˆ– en_US

# è®¾ç½®ç›®æ ‡ä¸–ç•Œå’ŒåŒºåŸŸ
world: "world"
target:
  start:
    x: -1000
    z: -1000
  end:
    x: 1000
    z: 1000

# é…ç½®è¦æ›¿æ¢çš„æ–¹å—
blocks:
  - origin: SHULKER_BOX
    target: AIR
  - origin: CHEST
    target: AIR

# å¼€å¯è‡ªåŠ¨ä¿®å¤é»‘è‰²åŒºå—
auto-fix-heightmap: true

# æ ¹æ®ä½¿ç”¨åœºæ™¯é€‰æ‹©é…ç½®
# ğŸ”µ åœ¨çº¿æœåŠ¡å™¨ï¼ˆå®‰å…¨ç¨³å®šï¼‰
parallel: 2
delay-between-batches-ms: 100

# ğŸŸ¢ ç¦»çº¿å¤„ç†ï¼ˆæœ€å¤§é€Ÿåº¦ï¼‰
# parallel: 8
# delay-between-batches-ms: 0
```

#### 3. æ‰§è¡Œå‘½ä»¤

```bash
/fawereplace start   # å¯åŠ¨æ¸…ç†ä»»åŠ¡
/fawereplace stop    # åœæ­¢ä»»åŠ¡å¹¶ä¿å­˜è¿›åº¦
/fawereplace status  # æŸ¥çœ‹å½“å‰è¿›åº¦
/fawereplace reload  # é‡è½½é…ç½®å’Œè¯­è¨€æ–‡ä»¶
```

**æƒé™èŠ‚ç‚¹**: `fawereplace.use`

### ğŸ“‹ é…ç½®è¯´æ˜

#### æ ¸å¿ƒé…ç½®é€‰é¡¹

| é…ç½®é¡¹ | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `language` | string | è¯­è¨€è®¾ç½®ï¼š`zh_CN` (ä¸­æ–‡) æˆ– `en_US` (è‹±æ–‡) |
| `world` | string | ç›®æ ‡ä¸–ç•Œåç§° |
| `parallel` | int | å¹¶è¡Œå¤„ç†çº¿ç¨‹æ•°ï¼Œå»ºè®®æ ¹æ®å†…å­˜å’Œ CPU æ ¸å¿ƒæ•°è®¾ç½® |
| `target.start/end` | åæ ‡ | éœ€è¦æ¸…ç†çš„åŒºåŸŸèŒƒå›´ï¼ˆx, z, y åæ ‡ï¼‰ |
| `region.x/z/y` | int | å•ä¸ªåˆ‡ç‰‡çš„å°ºå¯¸ï¼Œ`region.y` å¯çœç•¥ä»¥è¦†ç›–å…¨éƒ¨é«˜åº¦ |
| `auto-fix-heightmap` | bool | **[æ–°]** è‡ªåŠ¨ä¿®å¤åŒºå—é«˜åº¦å›¾ï¼Œé˜²æ­¢é»‘è‰²åŒºå—é—®é¢˜ |
| `skip-ungenerated-chunks` | bool | è·³è¿‡æœªç”Ÿæˆçš„åŒºå—ï¼Œé¿å…åŒºå—åŠ è½½é”™è¯¯ |

#### æ€§èƒ½è°ƒä¼˜é€‰é¡¹

| é…ç½®é¡¹ | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `performance.delay-between-batches-ms` | long | æ‰¹æ¬¡é—´å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰ï¼Œç”¨äºé™ä½æœåŠ¡å™¨è´Ÿè½½ |
| `performance.delay-between-chunks-ms` | long | åŒºå—é—´å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰ |
| `performance.gc-every-chunks` | int | æ¯å¤„ç† N ä¸ªåŒºå—æ‰§è¡Œåƒåœ¾å›æ”¶ï¼ˆ0=ç¦ç”¨ï¼‰ |

#### å†…å­˜ä¿æŠ¤é€‰é¡¹

| é…ç½®é¡¹ | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `memory-protection.enabled` | bool | å¯ç”¨å†…å­˜ä¿æŠ¤æœºåˆ¶ |
| `memory-protection.min-free-memory-percent` | double | æœ€å°å¯ç”¨å†…å­˜ç™¾åˆ†æ¯”ï¼ˆ0.0-1.0ï¼‰ |
| `memory-protection.wait-on-low-memory-ms` | long | å†…å­˜ä¸è¶³æ—¶ç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ |
| `memory-protection.max-memory-retries` | int | å†…å­˜ä¸è¶³æ—¶æœ€å¤§é‡è¯•æ¬¡æ•° |

#### æ–­ç‚¹ç»­è·‘é€‰é¡¹

| é…ç½®é¡¹ | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `resume.enabled` | bool | å¯ç”¨æ–­ç‚¹ç»­è·‘åŠŸèƒ½ |
| `resume.file` | string | è¿›åº¦æ–‡ä»¶åç§°ï¼ˆé»˜è®¤ `progress.yml`ï¼‰ |
| `resume.save-every` | int | æ¯å¤„ç†å¤šå°‘åˆ‡ç‰‡ä¿å­˜ä¸€æ¬¡è¿›åº¦ |

#### æ–¹å—å’Œå®ä½“æ¸…ç†

| é…ç½®é¡¹ | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `blocks` | list | æ–¹å—æ›¿æ¢è§„åˆ™åˆ—è¡¨ï¼ˆorigin â†’ targetï¼‰ |
| `entities.enabled` | bool | å¯ç”¨å®ä½“æ¸…ç†åŠŸèƒ½ |
| `entities.types` | list | è¦æ¸…ç†çš„å®ä½“ç±»å‹åˆ—è¡¨ï¼ˆå¦‚ ITEM, ZOMBIEï¼‰ |

### ğŸ¯ é…ç½®é¢„è®¾æ¨è

#### ğŸ”µ åœ¨çº¿æœåŠ¡å™¨ï¼ˆå®‰å…¨ç¨³å®šï¼‰
```yaml
parallel: 2-3
delay-between-batches-ms: 100
delay-between-chunks-ms: 20
gc-every-chunks: 50
min-free-memory-percent: 0.20
auto-fix-heightmap: true
```

#### ğŸŸ¢ ç¦»çº¿é«˜æ€§èƒ½å¤„ç†ï¼ˆæœ€å¤§é€Ÿåº¦ï¼‰
```yaml
parallel: 8-12  # æ ¹æ® RAM è°ƒæ•´
delay-between-batches-ms: 0
delay-between-chunks-ms: 0
gc-every-chunks: 0
min-free-memory-percent: 0.12
auto-fix-heightmap: true
```

#### ğŸŸ¡ å¹³è¡¡é…ç½®ï¼ˆæ€§èƒ½ä¸ç¨³å®šå…¼é¡¾ï¼‰
```yaml
parallel: 4
delay-between-batches-ms: 50
delay-between-chunks-ms: 10
gc-every-chunks: 0
min-free-memory-percent: 0.15
auto-fix-heightmap: true
```

> **ğŸ’¡ æç¤º**: 16wÃ—16w å¤§å‹åœ°å›¾å»ºè®®ä½¿ç”¨ `region.x/z = 512`ã€å¹¶è¡Œåº¦ 4-8ã€å¯ç”¨ `resume.enabled = true`

### ğŸ’¾ æ–­ç‚¹ç»­è·‘ & æ—¥å¿—ç³»ç»Ÿ

#### è¿›åº¦ä¿å­˜æœºåˆ¶

- **è¿›åº¦æ–‡ä»¶ä½ç½®**: `plugins/FAWEReplace/progress.yml`
- **ä¿å­˜æ—¶æœº**: 
  - æ‰§è¡Œ `/fawereplace stop` æ—¶å¼ºåˆ¶ä¿å­˜
  - è¿è¡Œè¿‡ç¨‹ä¸­æŒ‰ `resume.save-every` é¢‘ç‡è‡ªåŠ¨ä¿å­˜
  - ä»»åŠ¡å®Œæˆåè‡ªåŠ¨åˆ é™¤è¿›åº¦æ–‡ä»¶
- **ä¿å­˜å†…å®¹**: å½“å‰åŒºåŸŸã€åˆ‡ç‰‡å°ºå¯¸ã€å·²å®Œæˆåˆ‡ç‰‡æ•°ã€æ›¿æ¢ç»Ÿè®¡

#### æ–­ç‚¹æ¢å¤

1. ä¿æŒ `resume.enabled = true`
2. ä»»åŠ¡ä¸­æ–­åç¡®ä¿ `progress.yml` å­˜åœ¨
3. å†æ¬¡æ‰§è¡Œ `/fawereplace start`
4. æ’ä»¶ä¼šéªŒè¯é…ç½®ä¸€è‡´æ€§åè‡ªåŠ¨ç»§ç»­

#### æ—¥å¿—æ–‡ä»¶

- **æ–‡ä»¶ä½ç½®**: `plugins/FAWEReplace/clean-log.txt`
- **è®°å½•å†…å®¹**: 
  - æ¯æ¬¡ä»»åŠ¡å¼€å§‹/åœæ­¢/å®Œæˆçš„æ—¶é—´æˆ³
  - å¤„ç†çš„åŒºåŸŸèŒƒå›´å’Œåˆ‡ç‰‡ä¿¡æ¯
  - æ–¹å—æ›¿æ¢æ•°é‡ç»Ÿè®¡
  - å®ä½“æ¸…ç†æ•°é‡ç»Ÿè®¡
  - ä»»åŠ¡è€—æ—¶å’Œæ€§èƒ½æŒ‡æ ‡

### ğŸ—ï¸ æŠ€æœ¯æ¶æ„

#### æ ¸å¿ƒæŠ€æœ¯ç‰¹ç‚¹

- **æ‡’åŠ è½½åˆ‡ç‰‡è°ƒåº¦**: ä½¿ç”¨åŸå­è®¡æ•°å™¨æŒ‰éœ€ç”Ÿæˆåˆ‡ç‰‡åæ ‡ï¼Œé¿å…é¢„å…ˆåˆ›å»ºæ•°ç™¾ä¸‡ä¸ªä»»åŠ¡å¯¹è±¡
- **å¤šçº¿ç¨‹å¼‚æ­¥å¤„ç†**: é€šè¿‡ FAWE çš„ `EditSession` åœ¨å·¥ä½œçº¿ç¨‹ä¸­å¹¶è¡Œå¤„ç†æ–¹å—æ›¿æ¢
- **çº¿ç¨‹å®‰å…¨è®¾è®¡**: å®ä½“æ“ä½œåœ¨ä¸»çº¿ç¨‹è°ƒåº¦ï¼Œæ–¹å—æ“ä½œåœ¨å¼‚æ­¥çº¿ç¨‹ï¼Œç¡®ä¿æ•°æ®å®‰å…¨
- **è¿›åº¦æŒä¹…åŒ–**: åˆ‡ç‰‡è¿›åº¦ã€ç»Ÿè®¡æ•°æ®å®æ—¶ä¿å­˜åˆ° YAML æ–‡ä»¶ï¼Œæ”¯æŒæ–­ç‚¹ç»­è·‘
- **å†…å­˜æ™ºèƒ½ç®¡ç†**: å®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨ï¼Œè‡ªåŠ¨è§¦å‘ GC å’Œæš‚åœæœºåˆ¶ï¼Œé˜²æ­¢ OOM
- **é«˜åº¦å›¾è‡ªåŠ¨ä¿®å¤**: å¤„ç†åè‡ªåŠ¨åˆ·æ–°åŒºå—é«˜åº¦å›¾ï¼Œé¿å…æ¸²æŸ“é—®é¢˜

#### å®‰å…¨ä¿éšœæœºåˆ¶

1. **ä¸‰å±‚åŒºå—å®‰å…¨æ£€æŸ¥**:
   - æ£€æŸ¥åŒºå—æ˜¯å¦å·²ç”Ÿæˆ
   - è¿‡æ»¤å·²åŠ è½½çš„åŒºå—
   - éªŒè¯ TileEntity å…¼å®¹æ€§

2. **æ•°æ®å®Œæ•´æ€§ä¿æŠ¤**:
   - é…ç½®ä¸€è‡´æ€§éªŒè¯
   - è¿›åº¦æ–‡ä»¶æ ¡éªŒ
   - å¼‚å¸¸æ¢å¤æœºåˆ¶

3. **æ€§èƒ½ç›‘æ§**:
   - å†…å­˜ä½¿ç”¨ç‡ç›‘æ§
   - å¤„ç†é€Ÿåº¦ç»Ÿè®¡
   - è‡ªåŠ¨èŠ‚æµæœºåˆ¶

### ğŸ› ï¸ å¼€å‘ä¸æ„å»º

#### å¼€å‘ç¯å¢ƒè¦æ±‚

- **Java**: 17 æˆ–æ›´é«˜ç‰ˆæœ¬
- **æ„å»ºå·¥å…·**: Gradle (å·²å†…ç½® Wrapper)
- **IDE**: IntelliJ IDEA / Eclipse / VS Code

#### æ„å»ºå‘½ä»¤

```bash
# æ¸…ç†å¹¶æ„å»ºé¡¹ç›®
./gradlew clean build

# è¿è¡Œæœ¬åœ°æµ‹è¯•æœåŠ¡å™¨
./gradlew runServer

# ä»…ç¼–è¯‘ï¼ˆä¸æ‰“åŒ…ï¼‰
./gradlew compileJava

# ç”Ÿæˆ Shadow JARï¼ˆåŒ…å«ä¾èµ–ï¼‰
./gradlew shadowJar
```

#### é¡¹ç›®ç»“æ„

```
src/main/java/org/cubexmc/fawereplace/
â”œâ”€â”€ FAWEReplace.java              # ä¸»æ’ä»¶ç±»
â”œâ”€â”€ LanguageManager.java          # å¤šè¯­è¨€ç®¡ç†å™¨
â”œâ”€â”€ commands/
â”‚   â”œâ”€â”€ FaweReplaceCommand.java   # å‘½ä»¤æ‰§è¡Œå™¨
â”‚   â””â”€â”€ FaweReplaceTabCompleter.java  # Tab è¡¥å…¨
â””â”€â”€ tasks/
    â”œâ”€â”€ CleaningTask.java         # æ ¸å¿ƒæ¸…ç†ä»»åŠ¡
    â””â”€â”€ ChunkRepairTask.java      # åŒºå—ä¿®å¤å·¥å…·

src/main/resources/
â”œâ”€â”€ config.yml                    # é…ç½®æ–‡ä»¶
â”œâ”€â”€ plugin.yml                    # æ’ä»¶å…ƒæ•°æ®
â”œâ”€â”€ paper-plugin.yml              # Paper æ’ä»¶ä¿¡æ¯
â””â”€â”€ lang/
    â”œâ”€â”€ zh_CN.yml                 # ä¸­æ–‡è¯­è¨€æ–‡ä»¶
    â””â”€â”€ en_US.yml                 # è‹±æ–‡è¯­è¨€æ–‡ä»¶
```

#### è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼åœ¨æäº¤ PR å‰è¯·ç¡®ä¿ï¼š

1. ä»£ç éµå¾ªé¡¹ç›®ç°æœ‰é£æ ¼
2. æ·»åŠ å¿…è¦çš„æ³¨é‡Šå’Œæ–‡æ¡£
3. æµ‹è¯•é€šè¿‡ä¸”æ— æ˜æ˜¾ Bug
4. æ›´æ–°ç›¸å…³æ–‡æ¡£ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰

### â“ å¸¸è§é—®é¢˜

#### Q1: å¦‚ä½•ä»ä¸­æ–­å¤„ç»§ç»­ï¼Ÿ

**ç­”**: 
1. ç¡®ä¿é…ç½®ä¸­ `resume.enabled = true`
2. åœæ­¢ä»»åŠ¡åæ£€æŸ¥ `plugins/FAWEReplace/progress.yml` æ˜¯å¦å­˜åœ¨
3. å†æ¬¡æ‰§è¡Œ `/fawereplace start`
4. æ’ä»¶ä¼šè‡ªåŠ¨éªŒè¯é…ç½®å¹¶ç»§ç»­å¤„ç†

#### Q2: é‡åˆ°é»‘è‰²åŒºå—ï¼ˆåœ¨ MCA Selector ä¸­æ˜¾ç¤ºï¼‰æ€ä¹ˆåŠï¼Ÿ

**ç­”**: è¿™æ˜¯é«˜åº¦å›¾æŸåå¯¼è‡´çš„ã€‚è§£å†³æ–¹æ³•ï¼š
1. åœ¨é…ç½®ä¸­å¯ç”¨ `auto-fix-heightmap: true`ï¼ˆæ¨èï¼‰
2. æˆ–ä½¿ç”¨ä¿®å¤è„šæœ¬ï¼š`scripts/fix_black_chunks.bat` (Windows) æˆ– `scripts/fix_black_chunks.sh` (Linux)
3. æŸ¥çœ‹ `BLACK_CHUNKS_SOLUTION.md` è·å–è¯¦ç»†è¯´æ˜

#### Q3: æœåŠ¡å™¨å†…å­˜ä¸è¶³/å¡é¡¿æ€ä¹ˆåŠï¼Ÿ

**ç­”**: 
1. é™ä½ `parallel` å€¼ï¼ˆå»ºè®® 2-4ï¼‰
2. å¢åŠ  `delay-between-batches-ms`ï¼ˆå»ºè®® 50-100ï¼‰
3. è®¾ç½® `min-free-memory-percent: 0.20` æˆ–æ›´é«˜
4. å¯ç”¨ `gc-every-chunks: 50`
5. æŸ¥çœ‹ `PERFORMANCE_GUIDE.md` è·å–ä¼˜åŒ–å»ºè®®

#### Q4: å¦‚ä½•åªæ¸…ç†æ‰è½ç‰©ä¸æ¸…ç†æ–¹å—ï¼Ÿ

**ç­”**: 
```yaml
blocks: []  # æ¸…ç©ºæ–¹å—æ›¿æ¢åˆ—è¡¨
entities:
  enabled: true
  types:
    - ITEM
    - ARROW
```

#### Q5: æ”¯æŒåˆ†å¸ƒå¼å¤„ç†å—ï¼Ÿ

**ç­”**: æ”¯æŒï¼æŸ¥çœ‹ä»¥ä¸‹æ–‡æ¡£ï¼š
- `DISTRIBUTED_QUICKSTART.md` - å¿«é€Ÿå…¥é—¨
- `DISTRIBUTED_PROCESSING_GUIDE.md` - è¯¦ç»†æŒ‡å—
- ä½¿ç”¨ `scripts/split_world.sh` å’Œ `scripts/merge_worlds.sh` å·¥å…·

#### Q6: ä¼šè¯¯åˆ ç©å®¶å»ºç­‘çš„åŒºå—å—ï¼Ÿ

**ç­”**: ä¸ä¼šã€‚æ’ä»¶æœ‰ä¸‰å±‚å®‰å…¨ä¿æŠ¤ï¼š
1. åªå¤„ç†å·²ç”Ÿæˆçš„åŒºå—
2. è·³è¿‡å½“å‰åŠ è½½çš„åŒºå—
3. éªŒè¯ TileEntity å…¼å®¹æ€§
è¯¦è§ `CHUNK_SAFETY_ANALYSIS.md`

### ğŸ“š å®Œæ•´æ–‡æ¡£

- **[README.md](README.md)** - æœ¬æ–‡æ¡£
- **[PERFORMANCE_GUIDE.md](PERFORMANCE_GUIDE.md)** - æ€§èƒ½ä¼˜åŒ–å®Œæ•´æŒ‡å—
- **[BLACK_CHUNKS_SOLUTION.md](BLACK_CHUNKS_SOLUTION.md)** - é»‘è‰²åŒºå—é—®é¢˜è¯¦è§£
- **[LANGUAGE_SUPPORT.md](LANGUAGE_SUPPORT.md)** - å¤šè¯­è¨€åŠŸèƒ½è¯´æ˜
- **[DISTRIBUTED_QUICKSTART.md](DISTRIBUTED_QUICKSTART.md)** - åˆ†å¸ƒå¼å¤„ç†å¿«é€Ÿå…¥é—¨
- **[DISTRIBUTED_PROCESSING_GUIDE.md](DISTRIBUTED_PROCESSING_GUIDE.md)** - åˆ†å¸ƒå¼å¤„ç†è¯¦ç»†æŒ‡å—
- **[SAFETY_QUICK_REFERENCE.md](SAFETY_QUICK_REFERENCE.md)** - å®‰å…¨æ€§å¿«é€Ÿå‚è€ƒ
- **[CHUNK_SAFETY_ANALYSIS.md](CHUNK_SAFETY_ANALYSIS.md)** - åŒºå—å®‰å…¨æ€§è¯¦ç»†åˆ†æ
- **[CONFIG_COMPARISON.md](CONFIG_COMPARISON.md)** - é…ç½®å¯¹æ¯”è¯´æ˜

### ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

### ğŸ¤ è´¡çŒ®è€…

- **cong0707** - åˆå§‹å¼€å‘
- **angushushu** - åŠŸèƒ½å¢å¼ºã€å¤šè¯­è¨€æ”¯æŒã€æ€§èƒ½ä¼˜åŒ–

### ğŸ’¬ æ”¯æŒä¸åé¦ˆ

- **GitHub Issues**: [æäº¤é—®é¢˜](https://github.com/CubeX-MC/FAWEReplacer/issues)
- **æŸ¥çœ‹æ—¥å¿—**: `plugins/FAWEReplace/clean-log.txt`
- **è°ƒè¯•æ¨¡å¼**: åœ¨é…ç½®ä¸­å¯ç”¨è¯¦ç»†æ—¥å¿—

---

## English Documentation

### Introduction

**FAWEReplace** is a high-performance Paper plugin designed for large-scale Minecraft world cleanup tasks. Built on FastAsyncWorldEdit (FAWE)'s asynchronous capabilities, it efficiently handles bulk block replacement and entity removal operations.

**Version**: 1.0.3  
**Supports**: Minecraft 1.20.2+, Paper/Spigot  
**Requires**: FastAsyncWorldEdit (FAWE)

### âœ¨ Key Features

- ğŸŒ **Bulk Block Replacement** - Support for hundreds of block types with batch operations
- ğŸš€ **High-Performance Async Processing** - Multi-threaded parallel processing based on FAWE
- ğŸ“¦ **Lazy-Loading Tile Scheduling** - Handle 16wÃ—16w regions without pre-generating millions of tasks
- ğŸ’¾ **Resume from Checkpoint** - Auto-recovery after server interruption with progress tracking
- ğŸ­ **Entity Cleanup** - Optional entity type removal (dropped items, mobs, armor stands, etc.)
- ğŸŒ **Multi-Language Support** - Complete Chinese/English bilingual support
- ğŸ›¡ï¸ **Memory Protection** - Auto-monitoring to prevent OutOfMemoryError
- ğŸ”§ **Smart Chunk Repair** - Auto-fix heightmaps to prevent black chunks in MCA Selector
- ğŸ“Š **Real-time Progress Monitoring** - Live progress and detailed logs with replacement statistics
- âš™ï¸ **Flexible Configuration** - Support for both online server and offline processing modes

### ğŸš€ Quick Start

#### 1. Install the Plugin

**Option A: Download from Releases**
```bash
# Download the pre-built JAR file
# Place FAWEReplace-1.0.3-all.jar in your server's plugins/ directory
```

**Option B: Build from Source**
```bash
./gradlew clean build
# Place the generated build/libs/FAWEReplace-1.0.3-all.jar in plugins/ directory
```

#### 2. Configure the Plugin

After starting the server, edit `plugins/FAWEReplace/config.yml`:

```yaml
# Choose language
language: en_US  # or zh_CN

# Set target world and region
world: "world"
target:
  start:
    x: -1000
    z: -1000
  end:
    x: 1000
    z: 1000

# Configure blocks to replace
blocks:
  - origin: SHULKER_BOX
    target: AIR
  - origin: CHEST
    target: AIR

# Enable auto-fix for black chunks
auto-fix-heightmap: true

# Choose configuration based on your use case
# ğŸ”µ Online Server (Safe & Stable)
parallel: 2
delay-between-batches-ms: 100

# ğŸŸ¢ Offline Processing (Maximum Speed)
# parallel: 8
# delay-between-batches-ms: 0
```

#### 3. Execute Commands

```bash
/fawereplace start   # Start cleanup task
/fawereplace stop    # Stop and save progress
/fawereplace status  # View current progress
/fawereplace reload  # Reload config and language files
```

**Permission**: `fawereplace.use`

### ğŸ“‹ Configuration Guide

#### Core Options

| Option | Type | Description |
|--------|------|-------------|
| `language` | string | Language: `zh_CN` (Chinese) or `en_US` (English) |
| `world` | string | Target world name |
| `parallel` | int | Parallel processing threads, adjust based on RAM and CPU cores |
| `target.start/end` | coords | Region to clean (x, z, y coordinates) |
| `region.x/z/y` | int | Tile size, `region.y` optional to cover full height |
| `auto-fix-heightmap` | bool | **[New]** Auto-fix chunk heightmaps to prevent black chunks |
| `skip-ungenerated-chunks` | bool | Skip ungenerated chunks to avoid loading errors |

#### Performance Tuning

| Option | Type | Description |
|--------|------|-------------|
| `performance.delay-between-batches-ms` | long | Delay between batches (ms) to reduce server load |
| `performance.delay-between-chunks-ms` | long | Delay between chunks (ms) |
| `performance.gc-every-chunks` | int | Run GC every N chunks (0=disabled) |

#### Memory Protection

| Option | Type | Description |
|--------|------|-------------|
| `memory-protection.enabled` | bool | Enable memory protection |
| `memory-protection.min-free-memory-percent` | double | Minimum free memory ratio (0.0-1.0) |
| `memory-protection.wait-on-low-memory-ms` | long | Wait time when low on memory (ms) |
| `memory-protection.max-memory-retries` | int | Max retries when low on memory |

#### Resume/Checkpoint

| Option | Type | Description |
|--------|------|-------------|
| `resume.enabled` | bool | Enable resume from checkpoint |
| `resume.file` | string | Progress filename (default `progress.yml`) |
| `resume.save-every` | int | Save progress every N tiles |

#### Blocks and Entities

| Option | Type | Description |
|--------|------|-------------|
| `blocks` | list | Block replacement rules (origin â†’ target) |
| `entities.enabled` | bool | Enable entity cleanup |
| `entities.types` | list | Entity types to remove (e.g., ITEM, ZOMBIE) |

### ğŸ¯ Configuration Presets

#### ğŸ”µ Online Server (Safe & Stable)
```yaml
parallel: 2-3
delay-between-batches-ms: 100
delay-between-chunks-ms: 20
gc-every-chunks: 50
min-free-memory-percent: 0.20
auto-fix-heightmap: true
```

#### ğŸŸ¢ Offline High-Performance (Maximum Speed)
```yaml
parallel: 8-12  # Adjust based on RAM
delay-between-batches-ms: 0
delay-between-chunks-ms: 0
gc-every-chunks: 0
min-free-memory-percent: 0.12
auto-fix-heightmap: true
```

#### ğŸŸ¡ Balanced (Good Performance & Safety)
```yaml
parallel: 4
delay-between-batches-ms: 50
delay-between-chunks-ms: 10
gc-every-chunks: 0
min-free-memory-percent: 0.15
auto-fix-heightmap: true
```

> **ğŸ’¡ Tip**: For large 16wÃ—16w maps, use `region.x/z = 512`, parallel 4-8, and enable `resume.enabled = true`

### ğŸ’¾ Resume & Logging System

#### Progress Saving

- **Location**: `plugins/FAWEReplace/progress.yml`
- **Save Triggers**: 
  - Manual: `/fawereplace stop`
  - Automatic: Every `resume.save-every` tiles
  - Auto-delete: After task completion
- **Contents**: Current region, tile size, completed tiles, replacement stats

#### Resume from Checkpoint

1. Keep `resume.enabled = true`
2. Ensure `progress.yml` exists after interruption
3. Execute `/fawereplace start` again
4. Plugin verifies config consistency and continues

#### Log File

- **Location**: `plugins/FAWEReplace/clean-log.txt`
- **Contents**: 
  - Start/stop/completion timestamps
  - Processed region and tile info
  - Block replacement statistics
  - Entity cleanup statistics
  - Task duration and performance metrics

### ğŸ—ï¸ Technical Architecture

#### Core Features

- **Lazy-Loading Tile Scheduling**: Uses atomic counters to generate tile coordinates on-demand
- **Multi-threaded Async Processing**: Parallel block replacement via FAWE's `EditSession`
- **Thread-Safe Design**: Entity ops on main thread, block ops async for data safety
- **Progress Persistence**: Real-time progress and stats saved to YAML for resume capability
- **Smart Memory Management**: Real-time monitoring with auto-GC and pause to prevent OOM
- **Auto Heightmap Repair**: Refreshes chunk heightmaps after processing to avoid rendering issues

#### Safety Mechanisms

1. **Three-Layer Chunk Safety**:
   - Check if chunk is generated
   - Filter loaded chunks
   - Verify TileEntity compatibility

2. **Data Integrity Protection**:
   - Config consistency validation
   - Progress file verification
   - Exception recovery

3. **Performance Monitoring**:
   - Memory usage tracking
   - Processing speed stats
   - Auto-throttling

### ğŸ› ï¸ Development & Building

#### Requirements

- **Java**: 17 or higher
- **Build Tool**: Gradle (Wrapper included)
- **IDE**: IntelliJ IDEA / Eclipse / VS Code

#### Build Commands

```bash
# Clean and build
./gradlew clean build

# Run local test server
./gradlew runServer

# Compile only (no packaging)
./gradlew compileJava

# Generate Shadow JAR (with dependencies)
./gradlew shadowJar
```

#### Project Structure

```
src/main/java/org/cubexmc/fawereplace/
â”œâ”€â”€ FAWEReplace.java              # Main plugin class
â”œâ”€â”€ LanguageManager.java          # Multi-language manager
â”œâ”€â”€ commands/
â”‚   â”œâ”€â”€ FaweReplaceCommand.java   # Command executor
â”‚   â””â”€â”€ FaweReplaceTabCompleter.java  # Tab completion
â””â”€â”€ tasks/
    â”œâ”€â”€ CleaningTask.java         # Core cleanup task
    â””â”€â”€ ChunkRepairTask.java      # Chunk repair utility

src/main/resources/
â”œâ”€â”€ config.yml                    # Configuration
â”œâ”€â”€ plugin.yml                    # Plugin metadata
â”œâ”€â”€ paper-plugin.yml              # Paper plugin info
â””â”€â”€ lang/
    â”œâ”€â”€ zh_CN.yml                 # Chinese language file
    â””â”€â”€ en_US.yml                 # English language file
```

#### Contributing

We welcome Issues and Pull Requests! Before submitting a PR, please ensure:

1. Code follows the project's existing style
2. Add necessary comments and documentation
3. Tests pass without obvious bugs
4. Update relevant documentation (if necessary)

### â“ FAQ

#### Q1: How to resume from interruption?

**Answer**: 
1. Ensure `resume.enabled = true` in config
2. Check that `plugins/FAWEReplace/progress.yml` exists after stopping
3. Execute `/fawereplace start` again
4. Plugin auto-verifies config and continues

#### Q2: Seeing black chunks in MCA Selector?

**Answer**: This is caused by corrupted heightmaps. Solutions:
1. Enable `auto-fix-heightmap: true` in config (recommended)
2. Use repair scripts: `scripts/fix_black_chunks.bat` (Windows) or `scripts/fix_black_chunks.sh` (Linux)
3. See `BLACK_CHUNKS_SOLUTION.md` for details

#### Q3: Server running out of memory or lagging?

**Answer**: 
1. Reduce `parallel` value (recommend 2-4)
2. Increase `delay-between-batches-ms` (recommend 50-100)
3. Set `min-free-memory-percent: 0.20` or higher
4. Enable `gc-every-chunks: 50`
5. See `PERFORMANCE_GUIDE.md` for optimization tips

#### Q4: How to clean only entities, not blocks?

**Answer**: 
```yaml
blocks: []  # Empty block list
entities:
  enabled: true
  types:
    - ITEM
    - ARROW
```

#### Q5: Does it support distributed processing?

**Answer**: Yes! Check these documents:
- `DISTRIBUTED_QUICKSTART.md` - Quick start
- `DISTRIBUTED_PROCESSING_GUIDE.md` - Detailed guide
- Use `scripts/split_world.sh` and `scripts/merge_worlds.sh` tools

#### Q6: Will it delete player-built chunks?

**Answer**: No. The plugin has three safety layers:
1. Only processes generated chunks
2. Skips currently loaded chunks
3. Verifies TileEntity compatibility
See `CHUNK_SAFETY_ANALYSIS.md` for details

### ğŸ“š Complete Documentation

- **[README.md](README.md)** - This document
- **[PERFORMANCE_GUIDE.md](PERFORMANCE_GUIDE.md)** - Complete performance optimization guide
- **[BLACK_CHUNKS_SOLUTION.md](BLACK_CHUNKS_SOLUTION.md)** - Black chunks issue explained
- **[LANGUAGE_SUPPORT.md](LANGUAGE_SUPPORT.md)** - Multi-language feature documentation
- **[DISTRIBUTED_QUICKSTART.md](DISTRIBUTED_QUICKSTART.md)** - Distributed processing quickstart
- **[DISTRIBUTED_PROCESSING_GUIDE.md](DISTRIBUTED_PROCESSING_GUIDE.md)** - Distributed processing guide
- **[SAFETY_QUICK_REFERENCE.md](SAFETY_QUICK_REFERENCE.md)** - Safety quick reference
- **[CHUNK_SAFETY_ANALYSIS.md](CHUNK_SAFETY_ANALYSIS.md)** - Detailed chunk safety analysis
- **[CONFIG_COMPARISON.md](CONFIG_COMPARISON.md)** - Configuration comparison

### ğŸ“ License

This project is licensed under the MIT License. See [LICENSE](LICENSE) file for details.

### ğŸ¤ Contributors

- **cong0707** - Initial development
- **angushushu** - Feature enhancements, multi-language support, performance optimization

### ğŸ’¬ Support & Feedback

- **GitHub Issues**: [Submit an issue](https://github.com/CubeX-MC/FAWEReplacer/issues)
- **Check Logs**: `plugins/FAWEReplace/clean-log.txt`
- **Debug Mode**: Enable verbose logging in config

---

**Made with â¤ï¸ for the Minecraft community**

2. **è¿›åº¦æ–‡ä»¶æŠ¥â€œä¸åŒ¹é…â€è­¦å‘Š**
  - è¯´æ˜ä¸–ç•Œ/èŒƒå›´/åˆ‡ç‰‡å°ºå¯¸ä¸ä¿å­˜æ—¶ä¸ä¸€è‡´ï¼Œè¯·ç¡®è®¤ä¿®æ”¹é…ç½®æˆ–åˆ é™¤æ—§çš„ `progress.yml`

3. **å¦‚ä½•æ‰©å±•è¦æ¸…ç†çš„æ–¹å—ï¼Ÿ**
  - åœ¨ `blocks` åˆ—è¡¨ä¸­æ–°å¢ `{ origin: <Material>, target: <Material> }`
  - æ’ä»¶ä¼šè‡ªåŠ¨æŠŠç›¸åŒç›®æ ‡çš„æ–¹å—åˆå¹¶åˆ°åŒä¸€ä¸ª FAWE æ“ä½œä¸­ï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢

4. **å®ä½“æ¸…ç†ä¼šé˜»å¡å—ï¼Ÿ**
  - å®ä½“ç§»é™¤åœ¨ä¸»çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œï¼Œä½†ä½œç”¨èŒƒå›´æ˜¯å½“å‰åˆ‡ç‰‡çš„åŒ…å›´ç›’ã€‚è‹¥è¦é¿å…ä¸»çº¿ç¨‹æŠ–åŠ¨ï¼Œå¯å‡å°‘å®ä½“ç§ç±»æˆ–è°ƒä½å¹¶è¡Œåº¦ã€‚